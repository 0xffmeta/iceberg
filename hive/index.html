<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A table format for large, slow-moving tabular data">
    
    
    <link rel="../img/favicon.ico">

    
    <title>Hive - Apache Iceberg</title>
    

    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">
    <link href="../css/highlight.min.css" rel="stylesheet">
    <link href="../css/extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="..">Apache Iceberg</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="..">About</a>
</li>

                        
                            
<li >
    <a href="../community/">Community</a>
</li>

                        
                            
<li >
    <a href="../releases/">Releases</a>
</li>

                        
                            
<li >
    <a href="../trademarks/">Trademarks</a>
</li>

                        
                            
<li >
    <a href="../how-to-release/">How to Release</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tables <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../configuration/">Configuration</a>
</li>

                        
                            
<li >
    <a href="../schemas/">Schemas</a>
</li>

                        
                            
<li >
    <a href="../partitioning/">Partitioning</a>
</li>

                        
                            
<li >
    <a href="../evolution/">Table evolution</a>
</li>

                        
                            
<li >
    <a href="../maintenance/">Maintenance</a>
</li>

                        
                            
<li >
    <a href="../performance/">Performance</a>
</li>

                        
                            
<li >
    <a href="../reliability/">Reliability</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Spark <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../getting-started/">Getting Started</a>
</li>

                        
                            
<li >
    <a href="../spark-configuration/">Configuration</a>
</li>

                        
                            
<li >
    <a href="../spark-ddl/">DDL</a>
</li>

                        
                            
<li >
    <a href="../spark-queries/">Queries</a>
</li>

                        
                            
<li >
    <a href="../spark-writes/">Writes</a>
</li>

                        
                            
<li >
    <a href="../spark-procedures/">Maintenance Procedures</a>
</li>

                        
                            
<li >
    <a href="../spark-structured-streaming/">Structured Streaming</a>
</li>

                        
                            
<li >
    <a href="../spark#time-travel">Time Travel</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="https://trino.io/docs/current/connector/iceberg.html">Trino</a>
                    </li>
                
                
                
                    <li >
                        <a href="../flink/">Flink</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Hive</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Integrations <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../aws/">AWS</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="/javadoc/">Javadoc</a>
</li>

                        
                            
<li >
    <a href="../api/">Java API intro</a>
</li>

                        
                            
<li >
    <a href="../java-api-quickstart/">Java Quickstart</a>
</li>

                        
                            
<li >
    <a href="../custom-catalog/">Java Custom Catalog</a>
</li>

                        
                            
<li >
    <a href="../python-quickstart/">Python Quickstart</a>
</li>

                        
                            
<li >
    <a href="../python-api-intro/">Python API Intro</a>
</li>

                        
                            
<li >
    <a href="../python-feature-support/">Python Feature Support</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Format <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../terms/">Definitions</a>
</li>

                        
                            
<li >
    <a href="../spec/">Spec</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="https://github.com/apache/iceberg">GitHub</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">ASF <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="https://www.apache.org/licenses/">License</a>
</li>

                        
                            
<li >
    <a href="https://www.apache.org/security/">Security</a>
</li>

                        
                            
<li >
    <a href="https://www.apache.org/foundation/thanks.html">Sponsors</a>
</li>

                        
                            
<li >
    <a href="https://www.apache.org/foundation/sponsorship.html">Donate</a>
</li>

                        
                            
<li >
    <a href="https://www.apache.org/events/current-event.html">Events</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li >
                        <a rel="prev" href="../flink/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../aws/">
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#hive">Hive</a></li>
            <li class="second-level"><a href="#hive-read-support">Hive read support</a></li>
                
                <li class="third-level"><a href="#table-creation">Table creation</a></li>
                <li class="third-level"><a href="#features">Features</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<!--
 - Licensed to the Apache Software Foundation (ASF) under one or more
 - contributor license agreements.  See the NOTICE file distributed with
 - this work for additional information regarding copyright ownership.
 - The ASF licenses this file to You under the Apache License, Version 2.0
 - (the "License"); you may not use this file except in compliance with
 - the License.  You may obtain a copy of the License at
 -
 -   http://www.apache.org/licenses/LICENSE-2.0
 -
 - Unless required by applicable law or agreed to in writing, software
 - distributed under the License is distributed on an "AS IS" BASIS,
 - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 - See the License for the specific language governing permissions and
 - limitations under the License.
 -->

<h1 id="hive">Hive<a class="headerlink" href="#hive" title="Permanent link">&para;</a></h1>
<h2 id="hive-read-support">Hive read support<a class="headerlink" href="#hive-read-support" title="Permanent link">&para;</a></h2>
<p>Iceberg supports the reading of Iceberg tables from <a href="https://hive.apache.org">Hive</a> by using a <a href="https://cwiki.apache.org/confluence/display/Hive/StorageHandlers">StorageHandler</a>. Please note that only Hive 2.x versions are currently supported.</p>
<h3 id="table-creation">Table creation<a class="headerlink" href="#table-creation" title="Permanent link">&para;</a></h3>
<p>This section explains the various steps needed in order to overlay a Hive table &ldquo;on top of&rdquo; an existing Iceberg table. Iceberg tables are created using either a <a href="../javadoc/master/?org/apache/iceberg/catalog/Catalog.html"><code>Catalog</code></a> or an implementation of the <a href="../javadoc/master/?org/apache/iceberg/Tables.html"><code>Tables</code></a> interface and Hive needs to be configured accordingly to read data from these different types of table.</p>
<h4 id="add-the-iceberg-hive-runtime-jar-file-to-the-hive-classpath">Add the Iceberg Hive Runtime jar file to the Hive classpath<a class="headerlink" href="#add-the-iceberg-hive-runtime-jar-file-to-the-hive-classpath" title="Permanent link">&para;</a></h4>
<p>Regardless of the table type, the <code>HiveIcebergStorageHandler</code> and supporting classes need to be made available on Hive&rsquo;s classpath. These are provided by the <code>iceberg-hive-runtime</code> jar file. For example, if using the Hive shell, this can be achieved by issuing a statement like so:</p>
<pre><code class="sql">add jar /path/to/iceberg-hive-runtime.jar;
</code></pre>

<p>There are many others ways to achieve this including adding the jar file to Hive&rsquo;s auxiliary classpath (so it is available by default) - please refer to Hive&rsquo;s documentation for more information.</p>
<h4 id="using-hadoop-tables">Using Hadoop Tables<a class="headerlink" href="#using-hadoop-tables" title="Permanent link">&para;</a></h4>
<p>Iceberg tables created using <code>HadoopTables</code> are stored entirely in a directory in a filesystem like HDFS.</p>
<h5 id="create-an-iceberg-table">Create an Iceberg table<a class="headerlink" href="#create-an-iceberg-table" title="Permanent link">&para;</a></h5>
<p>The first step is to create an Iceberg table using the Spark/Java/Python API and <code>HadoopTables</code>. For the purposes of this documentation we will assume that the table is called <code>table_a</code> and that the table location is <code>hdfs://some_path/table_a</code>.</p>
<h5 id="create-a-hive-table">Create a Hive table<a class="headerlink" href="#create-a-hive-table" title="Permanent link">&para;</a></h5>
<p>Now overlay a Hive table on top of this Iceberg table by issuing Hive DDL like so:</p>
<pre><code class="sql">CREATE EXTERNAL TABLE table_a 
STORED BY 'org.apache.iceberg.mr.hive.HiveIcebergStorageHandler' 
LOCATION 'hdfs://some_bucket/some_path/table_a';
</code></pre>

<h4 id="query-the-iceberg-table-via-hive">Query the Iceberg table via Hive<a class="headerlink" href="#query-the-iceberg-table-via-hive" title="Permanent link">&para;</a></h4>
<p>You should now be able to issue Hive SQL <code>SELECT</code> queries using the above table and see the results returned from the underlying Iceberg table.</p>
<pre><code class="sql">SELECT * from table_a;
</code></pre>

<h4 id="using-hive-catalog">Using Hive Catalog<a class="headerlink" href="#using-hive-catalog" title="Permanent link">&para;</a></h4>
<p>Iceberg tables created using <code>HiveCatalog</code> are automatically registered with Hive.</p>
<h5 id="create-an-iceberg-table_1">Create an Iceberg table<a class="headerlink" href="#create-an-iceberg-table_1" title="Permanent link">&para;</a></h5>
<p>The first step is to create an Iceberg table using the Spark/Java/Python API and <code>HiveCatalog</code>. For the purposes of this documentation we will assume that the table is called <code>table_b</code> and that the table location is <code>s3://some_path/table_b</code>. In order for Iceberg to correctly set up the Hive table for querying some configuration values need to be set, the two options for this are described below - you can use either or the other depending on your use case.</p>
<h5 id="hive-configuration">Hive Configuration<a class="headerlink" href="#hive-configuration" title="Permanent link">&para;</a></h5>
<p>The value <code>iceberg.engine.hive.enabled</code> needs to be set to <code>true</code> and added to the Hive configuration file on the classpath of the application creating or modifying (altering, inserting etc.) the table. This can be done by modifying the relevant <code>hive-site.xml</code>. Alternatively this can be done programmatically like so:</p>
<pre><code class="java">Configuration hadoopConfiguration = spark.sparkContext().hadoopConfiguration();
hadoopConfiguration.set(ConfigProperties.ENGINE_HIVE_ENABLED, &quot;true&quot;); //iceberg.engine.hive.enabled=true
HiveCatalog catalog = new HiveCatalog(hadoopConfiguration);
...
catalog.createTable(tableId, schema, spec);
</code></pre>

<h5 id="table-property-configuration">Table Property Configuration<a class="headerlink" href="#table-property-configuration" title="Permanent link">&para;</a></h5>
<p>The property <code>engine.hive.enabled</code> needs to be set to <code>true</code> and added to the table properties when creating the Iceberg table. This can be done like so:</p>
<pre><code class="java">    Map&lt;String, String&gt; tableProperties = new HashMap&lt;String, String&gt;();
    tableProperties.put(TableProperties.ENGINE_HIVE_ENABLED, &quot;true&quot;); //engine.hive.enabled=true
    catalog.createTable(tableId, schema, spec, tableProperties);
</code></pre>

<h4 id="query-the-iceberg-table-via-hive_1">Query the Iceberg table via Hive<a class="headerlink" href="#query-the-iceberg-table-via-hive_1" title="Permanent link">&para;</a></h4>
<p>In order to query a Hive table created by either of the HiveCatalog methods described above you need to first set a Hive configuration value like so:</p>
<pre><code class="sql">SET iceberg.mr.catalog=hive;
</code></pre>

<p>You should now be able to issue Hive SQL <code>SELECT</code> queries using the above table and see the results returned from the underlying Iceberg table.</p>
<pre><code class="sql">SELECT * from table_b;
</code></pre>

<h4 id="using-hadoop-catalog">Using Hadoop Catalog<a class="headerlink" href="#using-hadoop-catalog" title="Permanent link">&para;</a></h4>
<p>Iceberg tables created using <code>HadoopCatalog</code> are stored entirely in a directory in a filesystem like HDFS.</p>
<h5 id="create-an-iceberg-table_2">Create an Iceberg table<a class="headerlink" href="#create-an-iceberg-table_2" title="Permanent link">&para;</a></h5>
<p>The first step is to create an Iceberg table using the Spark/Java/Python API and <code>HadoopCatalog</code>. For the purposes of this documentation we will assume that the fully qualified table identifier is <code>database_a.table_c</code> and that the Hadoop Catalog warehouse location is <code>hdfs://some_bucket/path_to_hadoop_warehouse</code>. Iceberg will therefore create the table at the location <code>hdfs://some_bucket/path_to_hadoop_warehouse/database_a/table_c</code>.</p>
<h5 id="create-a-hive-table_1">Create a Hive table<a class="headerlink" href="#create-a-hive-table_1" title="Permanent link">&para;</a></h5>
<p>Now overlay a Hive table on top of this Iceberg table by issuing Hive DDL like so:</p>
<pre><code class="sql">CREATE EXTERNAL TABLE database_a.table_c 
STORED BY 'org.apache.iceberg.mr.hive.HiveIcebergStorageHandler' 
LOCATION 'hdfs://some_bucket/path_to_hadoop_warehouse/database_a/table_c'
TBLPROPERTIES (
  'iceberg.mr.catalog'='hadoop', 
  'iceberg.mr.catalog.hadoop.warehouse.location'='hdfs://some_bucket/path_to_hadoop_warehouse')
;
</code></pre>

<p>Note that the Hive database and table name <em>must</em> match the values used in the Iceberg <code>TableIdentifier</code> when the table was created. </p>
<p>It is possible to omit either or both of the table properties but instead you will then need to set these when reading from the table. Generally it is recommended to set them at table creation time so you can query tables created by different catalogs. </p>
<h4 id="query-the-iceberg-table-via-hive_2">Query the Iceberg table via Hive<a class="headerlink" href="#query-the-iceberg-table-via-hive_2" title="Permanent link">&para;</a></h4>
<p>You should now be able to issue Hive SQL <code>SELECT</code> queries using the above table and see the results returned from the underlying Iceberg table.</p>
<pre><code class="sql">SELECT * from database_a.table_c;
</code></pre>

<h3 id="features">Features<a class="headerlink" href="#features" title="Permanent link">&para;</a></h3>
<h4 id="predicate-pushdown">Predicate pushdown<a class="headerlink" href="#predicate-pushdown" title="Permanent link">&para;</a></h4>
<p>Pushdown of the Hive SQL <code>WHERE</code> clause has been implemented so that these filters are used at the Iceberg TableScan level as well as by the Parquet and ORC Readers.</p>
<h4 id="column-projection">Column Projection<a class="headerlink" href="#column-projection" title="Permanent link">&para;</a></h4>
<p>Columns from the Hive SQL <code>SELECT</code> clause are projected down to the Iceberg readers to reduce the number of columns read.</p>
<h4 id="hive-query-engines">Hive Query Engines<a class="headerlink" href="#hive-query-engines" title="Permanent link">&para;</a></h4>
<p>Both the Map Reduce and Tez query execution engines are supported.</p></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Copyright 2018-2021 <a href='https://www.apache.org/'>The Apache Software Foundation</a><br />Apache Iceberg, Iceberg, Apache, the Apache feather logo, and the Apache Iceberg project logo are either registered<br />trademarks or trademarks of The Apache Software Foundation in the United States and other countries.<br></small>
        
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>

        
        
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>var base_url = ".."</script>
    
    <script src="../js/base.js"></script>

    <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
